---
name: â™»ï¸ CI Workflow
on:
  pull_request:
    branches:
      - "*"

env:
  CI: ${{ vars.CI }}
  HUSKY: ${{ vars.HUSKY }}

jobs:
  commit-lint:
    name: ğŸ§¹ Commit Lint
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸŒ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: package.json

      - name: ğŸ“¦ Install pnpm
        uses: pnpm/action-setup@v4
        with:
          package_json_file: package.json
          run_install: false

      - name: ğŸ“¦ Install Dependencies
        run: pnpm install

      - name: ğŸ§¹ Lint Commits
        uses: wagoid/commitlint-github-action@v6
        with:
          configFile: .commitlintrc.ts
          helpURL: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

  build-lint:
    name: ğŸ§±ğŸ§¹ Build Packages and Lint Codebase
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ Checkout
        uses: actions/checkout@v4

      - name: ğŸŒ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: package.json

      - name: ğŸ“¦ Install pnpm
        uses: pnpm/action-setup@v4
        with:
          package_json_file: package.json
          run_install: false

      - name: ğŸ“¦ Install Dependencies
        run: pnpm install

      # NOTE: Must build packages before linting due to official plugins dependency on @maiar-ai/core package - Linting will fail upfront otherwise
      - name: ğŸ§± Build Packages
        run: pnpm run build

      - name: ğŸ§¹ Lint TypeScript
        run: pnpm run lint

      - name: ğŸ§¹ Lint ESLint
        run: pnpm run eslint
